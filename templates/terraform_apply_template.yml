parameters:
- name: tfWorkingDir
  type: string
  displayName: Terraform Working Directory
  default: $(Pipeline.Workspace)
- name: extraArgs
  type: string
  displayName: secret env vars to be passed to tf command
  default: ''

steps:
  - script: |
      echo "##[group]Running terraform Apply"
      terraform init
      terraform apply -auto-approve -var=$EXTRA_ARGS

    workingDirectory: ${{ parameters.tfWorkingDir }}
    displayName: 'Terraform Apply'
    failOnStderr: true
    env:
      ARM_CLIENT_ID: $(Client_ID)
      ARM_CLIENT_SECRET: $(Client_Secret)
      ARM_TENANT_ID: $(Tenant_ID)
      ARM_SUBSCRIPTION_ID: $(Subscription_ID)
      ACCOUNT_KEY: $(Storage_Account_Key)
      EXTRA_ARGS: ${{ parameters.extraArgs }}
